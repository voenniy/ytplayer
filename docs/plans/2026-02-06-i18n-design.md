# Мультиязычность (i18n) для MusicPlay

> Дата: 2026-02-06

## Решения

- **Языки:** русский (по умолчанию), казахский, английский. Расширяемо.
- **Определение:** авто по `navigator.language` + ручное переключение
- **Подход:** легковесный свой (React Context + JSON), без внешних библиотек
- **UI переключателя:** на странице логина + в основном интерфейсе (desktop и mobile)
- **Дизайн:** макеты в Pencil перед реализацией

## Архитектура

```
client/src/
├── i18n/
│   ├── index.ts           # Контекст, провайдер, хук useTranslation
│   ├── locales/
│   │   ├── ru.ts          # Русские строки (по умолчанию)
│   │   ├── en.ts          # Английские строки
│   │   └── kk.ts          # Казахские строки
│   └── types.ts           # Типы ключей переводов
```

### Как работает

1. `I18nProvider` оборачивает приложение, хранит текущий язык в `localStorage`
2. При первом заходе — определяет язык по `navigator.language` (ru, kk, en), fallback на `ru`
3. Хук `useTranslation()` возвращает функцию `t(key)` и `locale` / `setLocale`
4. Ключи типизированы через TypeScript — опечатка = ошибка компиляции
5. Плюрализация через суффиксы `_one`, `_few`, `_many`

### Пример использования

```tsx
const { t } = useTranslation()
// Было: "Очередь пуста"
// Стало: t('queue.empty')
```

## Структура ключей

Плоская с точечной нотацией (~50 ключей):

- `loading`, `logout`
- `login.*` — логин-страница
- `search.*` — поиск
- `nav.*` — навигация
- `track.*` — действия с треками
- `playlist.*` — плейлисты
- `queue.*` — очередь
- `player.*` — плеер

## UI переключателя

Компонент `LanguageSwitcher` на shadcn `DropdownMenu`:
- Кнопка: Globe иконка + код языка (RU/KK/EN)
- Dropdown: список языков с галочкой у текущего
- Мгновенная смена без перезагрузки

Размещение:
1. Страница логина — правый верхний угол
2. Desktop — sidebar рядом с кнопкой «Выйти»
3. Mobile — в шапке или MobileNav

## План работ

### Этап 1 — Дизайн (Designer)
- Макет переключателя на странице логина в Pencil
- Макет переключателя в основном интерфейсе (desktop + mobile)

### Этап 2 — Ядро i18n (Frontend)
- `i18n/types.ts`, `i18n/index.ts`
- Файлы переводов: `ru.ts`, `en.ts`, `kk.ts`
- Обернуть `App` в `I18nProvider`

### Этап 3 — Миграция компонентов (Frontend)
- Заменить захардкоженные строки на `t(key)` в 13 файлах

### Этап 4 — UI переключателя (Frontend)
- Компонент `LanguageSwitcher`
- Интеграция в LoginPage, Layout, MobileNav

### Этап 5 — Тесты (QA)
- Обновить существующие тесты
- Тесты переключения, автоопределения, localStorage
